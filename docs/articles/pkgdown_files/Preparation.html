<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preparation • keyATM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Preparation">
<meta property="og:description" content="keyATM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">keyATM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    User's Guide
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/pkgdown_files/Installation.html">Installation</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Preparation.html">Preparation</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_base.html">keyATM Base</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_cov.html">keyATM Covariates</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_dynamic.html">keyATM Dynamic</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Weighted_LDA.html">Weighted LDA</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Resume.html">Resume Fitting</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Plot.html">Plot Customization</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Options.html">Options</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/pkgdown_files/FAQ.html">FAQ</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/keyATM/keyATM" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preparation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keyATM/keyATM/blob/HEAD/vignettes/pkgdown_files/Preparation.Rmd" class="external-link"><code>vignettes/pkgdown_files/Preparation.Rmd</code></a></small>
      <div class="hidden name"><code>Preparation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="preparing-texts">Preparing Texts<a class="anchor" aria-label="anchor" href="#preparing-texts"></a>
</h2>
<p>To fit topic models with <strong>keyATM</strong>, users need to
transform their text data using <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>. This page
explains three ways to input text data into
<code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>.</p>
<div class="section level3">
<h3 id="using-quanteda-dfm-recommended">Using quanteda dfm (<strong>recommended</strong>)<a class="anchor" aria-label="anchor" href="#using-quanteda-dfm-recommended"></a>
</h3>
<p><strong>keyATM</strong> can read a document-feature matrix
(<code>dfm</code> object) created by <strong>quanteda</strong> package
(<strong>this method is strongly recommended</strong>). Since
<strong>keyATM</strong> does not provide preprocessing functions, we
recommend users to preprocess texts with <strong>quanteda</strong>. By
making a <code>token</code> object from a <code>corpus</code> object,
<strong>quanteda</strong> can perform various preprocessing methods (<a href="https://quanteda.io/articles/quickstart.html#tokenizing-texts" class="external-link">quanteda
Quick Start: Tokenizing texts</a>). Users can create a <code>dfm</code>
object from a <code>token</code> object.</p>
<div class="section level4">
<h4 id="loading-data-for-quanteda">Loading data for <strong>quanteda</strong><a class="anchor" aria-label="anchor" href="#loading-data-for-quanteda"></a>
</h4>
<p>Here is an example of loading text data and transform it into the
<strong>quanteda</strong> <code>corpus</code> format. We use the
<strong>readtext</strong> package in this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quanteda/readtext" class="external-link">readtext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read text files</span></span>
<span><span class="va">raw_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html" class="external-link">readtext</a></span><span class="op">(</span><span class="st">"PATH_TO_THE_FOLDER/*.txt"</span>,</span>
<span>                     encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preprocessing with quanteda and create a dfm object</span></span>
<span><span class="va">key_corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html" class="external-link">corpus</a></span><span class="op">(</span><span class="va">raw_docs</span>, text_field <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If you use the covariate model, please consider using `docvars` argument</span></span>
<span><span class="va">key_corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html" class="external-link">corpus</a></span><span class="op">(</span><span class="va">raw_docs</span>, text_field <span class="op">=</span> <span class="st">"text"</span>, docvars <span class="op">=</span> <span class="va">COVARIATES</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can conduct a variety of preprocessing in this step as shown in the next section</span></span>
<span><span class="va">key_token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens</a></span><span class="op">(</span><span class="va">key_corpus</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a document-feature matrix (a dfm object) from a token object</span></span>
<span><span class="va">key_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm.html" class="external-link">dfm</a></span><span class="op">(</span><span class="va">key_token</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="preprocessing-data">Preprocessing data<a class="anchor" aria-label="anchor" href="#preprocessing-data"></a>
</h4>
<p>We show a concrete example of preprocessing data and loading it into
the <strong>keyATM</strong>. We use the US presidential inaugural
address data that is one of the built-in datasets of the
<strong>quanteda</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyatm.github.io/keyATM/" class="external-link">keyATM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_corpus_inaugural</span>, package <span class="op">=</span> <span class="st">"quanteda"</span><span class="op">)</span></span>
<span><span class="va">data_corpus_inaugural</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_corpus_inaugural</span>, n <span class="op">=</span> <span class="fl">58</span><span class="op">)</span></span></code></pre></div>
<p>Since the US presidential speech dataset is a <code>corpus</code>
object, we use the <code><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens()</a></code> function to convert this data
into a <code>token</code> object and to preprocess texts before creating
a <code>dfm</code> object. The <code><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens()</a></code> and related
functions in the <strong>quanteda</strong> provide various preprocessing
functions. Preprocessing can reduce the number of unique features
(words) in the corpus, which is critical for increasing the
interpretability. In the example below, we adopt some of the most common
preprocessing steps.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tokens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens</a></span><span class="op">(</span></span>
<span>    <span class="va">data_corpus_inaugural</span>,</span>
<span>    remove_numbers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    remove_punct <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    remove_symbols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    remove_separators <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    remove_url <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/tokens_tolower.html" class="external-link">tokens_tolower</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html" class="external-link">tokens_remove</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span>,</span>
<span>      <span class="st">"may"</span>, <span class="st">"shall"</span>, <span class="st">"can"</span>,</span>
<span>      <span class="st">"must"</span>, <span class="st">"upon"</span>, <span class="st">"with"</span>, <span class="st">"without"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html" class="external-link">tokens_select</a></span><span class="op">(</span>min_nchar <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens()</a></code> function removes punctuations and
unnecessary characters,</p>
<p>The <code><a href="https://quanteda.io/reference/tokens_tolower.html" class="external-link">tokens_tolower()</a></code> function converts all characters
into lower cases, The <code><a href="https://quanteda.io/reference/tokens_select.html" class="external-link">tokens_remove()</a></code> function removes
general stop words (e.g, the, is, at, with
<code>stopwords("english")</code>) and corpus specific high frequent
words (“may”, “shall”, …, “without” in this example), and
<code>tokens_select</code> drops short words that do not usually
contribute to interpreting topics.</p>
<p>Before loading data into the <strong>keyATM</strong>, we construct a
document-feature matrix (<code>dfm</code> object) with the
<code><a href="https://quanteda.io/reference/dfm.html" class="external-link">dfm()</a></code> function in the <strong>quanteda</strong>. We trim
infrequent terms with the <code><a href="https://quanteda.io/reference/dfm_trim.html" class="external-link">dfm_trim()</a></code> function. We typically
aim for 7000 to 10000 unique words at the maximum.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm.html" class="external-link">dfm</a></span><span class="op">(</span><span class="va">data_tokens</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://quanteda.io/reference/dfm_trim.html" class="external-link">dfm_trim</a></span><span class="op">(</span>min_termfreq <span class="op">=</span> <span class="fl">5</span>, min_docfreq <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_dfm</span><span class="op">)</span>  <span class="co"># the number of unique words</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2568</span></span></code></pre>
<p>Finally, <code>keyATM_read</code> function reads your data for
<strong>keyATM</strong>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keyATM_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span><span class="op">(</span>texts <span class="op">=</span> <span class="va">data_dfm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">keyATM_docs</span><span class="op">)</span></span></code></pre></div>
<p>Researchers are required to remove any documents that do not contain
any terms before using the <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> function. If there
are documents that do not contain any terms, the
<code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> function raises a warning. It is highly
recommended to manually check documents with length 0 before fitting the
model, otherwise, the <strong>keyATM</strong> will automatically drop
these documents when fitting a model. Even so, we suggest users to
remove documents that do not contain any words as a part of
preprocessing. As explained in the later section, this process is
especially critical when the covariate model or the dynamic model is
fitted. The example below shows the warning that the
<code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> function displays.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keyATM_docs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span><span class="op">(</span>texts <span class="op">=</span> <span class="va">data_dfm_len0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There are documents with length 0 length. Indexes to check: 10 and 50</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> This may cause invalid covariates or time indexes. Please review the</span></span>
<span><span class="co">##   preprocessing steps.</span></span></code></pre>
<p>The warning message above indicates that there are two documents in
<code>data_dfm_len0</code> that do not contain any terms (the index 10
and 50). In the <strong>quanteda</strong>, we can easily remove
documents without any word counts with the following function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dfm_rm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm_subset.html" class="external-link">dfm_subset</a></span><span class="op">(</span><span class="va">data_dfm_len0</span>, <span class="fu"><a href="https://quanteda.io/reference/ntoken.html" class="external-link">ntoken</a></span><span class="op">(</span><span class="va">data_dfm_len0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="alternative-ways-to-load-texts-into-keyatm">Alternative ways to load texts into <strong>keyATM</strong><a class="anchor" aria-label="anchor" href="#alternative-ways-to-load-texts-into-keyatm"></a>
</h3>
<p>There are two other ways to read texts, which we do not recommend.
Please make sure to preprocess texts with other packages or softwares.
In both methods, each word should be separated by a single space.</p>
<div class="section level4">
<h4 id="using-data-frame-or-tibble">Using data.frame or tibble:<a class="anchor" aria-label="anchor" href="#using-data-frame-or-tibble"></a>
</h4>
<p><code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> can read <code>data.frame</code> and
<code>tibble</code> if you preprocess texts without
<strong>quanteda</strong>. Please store texts in a column named
<code>text</code>. Below shows the example of the required data
format.</p>
<pre><code>&gt; head(docs)  # `docs` stores preprocessed texts
# A tibble: 6 x 1
  text
  &lt;chr&gt;
1 h.r h.r one hundred first congress congress congress united u...
2 first congress one congress congress united united state stae...
3 one one one one one one one one one one one one one one one o...
4 h.r h.r one one one hundred hundred first first congress cong...
5 congress congress one united united united united united unit...
6 h.r h.r one one one one one hundred hundred first congress co...</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read texts into keyATM</span></span>
<span><span class="va">keyATM_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span><span class="op">(</span><span class="va">docs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="reading-directly-from-files">Reading directly from files:<a class="anchor" aria-label="anchor" href="#reading-directly-from-files"></a>
</h4>
<p>If you have preprocessed text files, you can pass a list of files to
<code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a list of paths to text files</span></span>
<span><span class="va">textfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">PATH_TO_THE_FOLDER</span>, pattern <span class="op">=</span> <span class="st">"*.txt"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read texts into keyATM</span></span>
<span><span class="va">keyATM_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span><span class="op">(</span><span class="va">textfiles</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="preparing-keywords">Preparing keywords<a class="anchor" aria-label="anchor" href="#preparing-keywords"></a>
</h2>
<div class="section level3">
<h3 id="create-keywords-list">Create keywords list<a class="anchor" aria-label="anchor" href="#create-keywords-list"></a>
</h3>
<p>Feeding keywords into models plays an essential role in the
<strong>keyATM</strong>. Researchers are expected to use their
substantive knowledge and to carefully select keywords.</p>
<p>In this application, suppose we are interested in five topics,
<em>Government</em>, <em>Congress</em>, <em>Peace</em>,
<em>Constitution</em>, and <em>Foreign affairs</em> and choose keywords
for each of these topics.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Government     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"laws"</span>, <span class="st">"law"</span>, <span class="st">"executive"</span><span class="op">)</span>,</span>
<span>  Congress       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congress"</span>, <span class="st">"party"</span><span class="op">)</span>,</span>
<span>  Peace          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peace"</span>, <span class="st">"world"</span>, <span class="st">"freedom"</span><span class="op">)</span>,</span>
<span>  Constitution   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"constitution"</span>, <span class="st">"rights"</span><span class="op">)</span>,</span>
<span>  ForeignAffairs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"foreign"</span>, <span class="st">"war"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A set of keywords should be stored in a list object, and we recommend
users to name each topic for clarity. Each keyword-topic can have a
different number of keywords.</p>
<p>You can also use the <code><a href="../../reference/read_keywords.html">read_keywords()</a></code> function to read a
dictionary object from quanteda to a named list.</p>
</div>
<div class="section level3">
<h3 id="checking-keywords">Checking keywords<a class="anchor" aria-label="anchor" href="#checking-keywords"></a>
</h3>
<p>Keywords should appear reasonable times (typically more than 0.1% of
the corpus) in the documents. The <code><a href="../../reference/visualize_keywords.html">visualize_keywords()</a></code>
function plots the frequency of keywords by topic.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">key_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/visualize_keywords.html">visualize_keywords</a></span><span class="op">(</span>docs <span class="op">=</span> <span class="va">keyATM_docs</span>, keywords <span class="op">=</span> <span class="va">keywords</span><span class="op">)</span></span>
<span><span class="va">key_viz</span></span></code></pre></div>
<p><img src="Preparation_files/figure-html/unnamed-chunk-12-1.png" width="700" style="display: block; margin: auto;">
The figure helps you to check the frequency of keywords. Including
low-frequency keywords do not help the model in general.</p>
<p>Proportion is defined as a number of times a keyword occurs in the
corpus divided by the total length of documents. This measures the
frequency of the keyword in the corpus. Formally, the proportion of the
keyword <span class="math inline">\(v\)</span> is, <span class="math display">\[
\begin{align*}
    \text{Proportion of }v = \frac{\sum_{d=1}^{D} \sum_{i=1}^{N_d}
I(w_{di} = v) }{\sum_{d=1}^{D} N_d}
\end{align*}
\]</span> where <span class="math inline">\(N_d\)</span> is the length
of the document <span class="math inline">\(d\)</span> and <span class="math inline">\(I\)</span> is an indicator function. Keywords of
each topic are ordered by the proportion (x-axis).</p>
<p>You can save the plot with the <code><a href="../../reference/save_fig.html">save_fig()</a></code> function,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">key_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/visualize_keywords.html">visualize_keywords</a></span><span class="op">(</span>docs <span class="op">=</span> <span class="va">keyATM_docs</span>, keywords <span class="op">=</span> <span class="va">keywords</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/save_fig.html">save_fig</a></span><span class="op">(</span><span class="va">key_viz</span>, <span class="st">"figures/keyword.pdf"</span>, width <span class="op">=</span> <span class="fl">6.5</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>and get the actual values with the <code><a href="../../reference/values_fig.html">values_fig()</a></code>
function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/values_fig.html">values_fig</a></span><span class="op">(</span><span class="va">key_viz</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 12 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   Topic [5]</span></span></span>
<span><span class="co">##    Word         WordCount `Proportion(%)` Ranking Topic           </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> laws               130           0.256       1 1_Government    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> law                129           0.254       2 1_Government    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> executive           97           0.191       3 1_Government    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> congress           130           0.256       1 2_Congress      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> party               81           0.159       2 2_Congress      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> world              311           0.612       1 3_Peace         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> peace              254           0.5         2 3_Peace         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> freedom            185           0.364       3 3_Peace         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> constitution       206           0.405       1 4_Constitution  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> rights             138           0.272       2 4_Constitution  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> war                174           0.342       1 5_ForeignAffairs</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> foreign            104           0.205       2 5_ForeignAffairs</span></span></code></pre>
<p>The <code>prune</code> argument of the
<code><a href="../../reference/visualize_keywords.html">visualize_keywords()</a></code> function is <code>TRUE</code> by
default. It drops keywords that do not appear in the corpus and raises a
warning if there is any.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Government <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"laws"</span>, <span class="st">"law"</span>, <span class="st">"non-exist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">key_viz2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/visualize_keywords.html">visualize_keywords</a></span><span class="op">(</span>docs <span class="op">=</span> <span class="va">keyATM_docs</span>, keywords <span class="op">=</span> <span class="va">keywords_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: A keyword is pruned because it does not appear in the</span></span>
<span><span class="co">## documents: non-exist</span></span></code></pre>
<p>If all keywords assigned to a topic is pruned, it raises an
error.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Government <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"non-exist"</span>, <span class="st">"non-exist2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">key_viz3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/visualize_keywords.html">visualize_keywords</a></span><span class="op">(</span>docs <span class="op">=</span> <span class="va">keyATM_docs</span>, keywords <span class="op">=</span> <span class="va">keywords_3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `check_keywords()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> All keywords are pruned. Please check: Government</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="choosing-keywords-with-an-unsupervised-topic-model">Choosing keywords with an unsupervised topic model<a class="anchor" aria-label="anchor" href="#choosing-keywords-with-an-unsupervised-topic-model"></a>
</h3>
<p>Besides choosing keywords using substantive knowledge, researchers
can select keywords based on the result of an unsupervised topic model
if they have a large enough corpus. The <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>
function can make a subset of the corpus by randomly splitting each
document (i.e., this is not a random sample of documents). In the
following example, we use 30% of each document to fit an unsupervised
model (results will not be meaningful because we only have 140
documents). An unsupervised model such as <a href="Weighted_LDA.html">the LDA</a> can explore the corpus. We use its
result to select keywords for the keyATM models (here, we fit <a href="keyATM_base.html">the base keyATM</a> with the remaining 70% of
corpus). This computer-assisted keyword selection does not mean that
researchers need to select all keywords from the top words of the LDA.
Researchers can use other methods such as a keyword selection algorithm
proposed in King, Lam and Roberts (2017).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">225</span><span class="op">)</span>  <span class="co"># set the seed before split the dfm</span></span>
<span><span class="va">docs_withSplit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span><span class="op">(</span>texts <span class="op">=</span> <span class="va">data_dfm</span>,</span>
<span>                              split <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>  <span class="co"># split each document</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/weightedLDA.html">weightedLDA</a></span><span class="op">(</span></span>
<span>  docs              <span class="op">=</span> <span class="va">docs_withSplit</span><span class="op">$</span><span class="va">W_split</span>,  <span class="co"># 30% of the corpus</span></span>
<span>  number_of_topics  <span class="op">=</span> <span class="fl">10</span>,  <span class="co"># the number of potential themes in the corpus</span></span>
<span>  model             <span class="op">=</span> <span class="st">"base"</span>,</span>
<span>  options           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/top_words.html">top_words</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>  <span class="co"># top words can aid selecting keywords</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/keyATM.html">keyATM</a></span><span class="op">(</span></span>
<span>  docs              <span class="op">=</span> <span class="va">docs_withSplit</span>,  <span class="co"># 70% of the corpus</span></span>
<span>  no_keyword_topics <span class="op">=</span> <span class="fl">5</span>,               <span class="co"># number of topics without keywords</span></span>
<span>  keywords          <span class="op">=</span> <span class="va">keywords</span>,        <span class="co"># selected keywords</span></span>
<span>  model             <span class="op">=</span> <span class="st">"base"</span>,          <span class="co"># select the model</span></span>
<span>  options           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="next-step">Next Step<a class="anchor" aria-label="anchor" href="#next-step"></a>
</h2>
<p>Now you have texts and keywords! The next step is to fit a model with
the <code><a href="../../reference/keyATM.html">keyATM()</a></code> function. <strong>keyATM</strong> has three
models:</p>
<ul>
<li>
<a href="keyATM_base.html">keyATM Base</a>
<ul>
<li>This is an extension of the most famous topic model, Latent
Dirichlet Allocation.</li>
<li>If you do not have covariates, this model is your first option.</li>
</ul>
</li>
<li>
<a href="keyATM_cov.html">keyATM Covariates</a>
<ul>
<li>If you have covariates, please use this model.</li>
<li>This model uses document-level meta data (document-level covariates)
to model topic prevalence (the prior of document-topic
distribution).</li>
</ul>
</li>
<li>
<a href="keyATM_dynamic.html">keyATM Dynamic</a>
<ul>
<li>If you want to explicitly consider time structure, please use this
model.</li>
</ul>
</li>
</ul>
<p>You can find details in <a href="FAQ.html#which-model-to-use">FAQ</a>.</p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<ul>
<li>King, Gary, Patrick Lam and Margaret E. Roberts. (2017).
Computer-Assisted Keyword and Document Set Discovery from Unstructured
Text. <em>American Journal of Political Science</em> 61:971–988.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://shusei-e.github.io" class="external-link">Shusei Eshima</a>, <a href="https://tomoya-sasaki.github.io/" class="external-link">Tomoya Sasaki</a>, <a href="https://imai.fas.harvard.edu/" class="external-link">Kosuke Imai</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
