<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preparation • keyATM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Preparation">
<meta property="og:description" content="keyATM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">keyATM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    User's Guide
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/pkgdown_files/Installation.html">Installation</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Preparation.html">Preparation</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_base.html">keyATM Base</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_cov.html">keyATM Covariates</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_dynamic.html">keyATM Dynamic</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/keyATM_label.html">keyATM Label</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Weighted_LDA.html">Weighted LDA</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Heterogeneity.html">Heterogeneity</a>
    </li>
    <li>
      <a href="../../articles/pkgdown_files/Options.html">Options</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/pkgdown_files/FAQ.html">FAQ</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/keyATM/keyATM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preparation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keyATM/keyATM/blob/master/vignettes/pkgdown_files/Preparation.Rmd"><code>vignettes/pkgdown_files/Preparation.Rmd</code></a></small>
      <div class="hidden name"><code>Preparation.Rmd</code></div>

    </div>

    
    
<div id="preparing-texts" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-texts" class="anchor"></a>Preparing Texts</h2>
<p>To fit topic models with <strong>keyATM</strong>, users need to prepare texts for <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>. <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> has three ways to input texts. If you want to check an example with a built-in dataset, please proceed to <a href="Preparation.html#reading-documents-into-keyatm">the next section</a>.</p>
<div id="using-quanteda-dfm-recommended" class="section level3">
<h3 class="hasAnchor">
<a href="#using-quanteda-dfm-recommended" class="anchor"></a>Using quanteda dfm (<strong>recommended</strong>)</h3>
<p><strong>keyATM</strong> can read a <code>dfm</code> object created by <strong>quanteda</strong> package (<strong>this method is strongly recommended</strong>). Since <strong>keyATM</strong> does not provide preprocessing functions, we recommend users to preprocess documents with <strong>quanteda</strong>. Please visit <a href="https://quanteda.io/articles/quickstart.html#creating-a-corpus">quanteda Quick Start: Creating a Corpus</a> to see how to create a <code>corpus</code> object.</p>
<p>By making a <code>token</code> object from a <code>corpus</code> object, <strong>quanteda</strong> can perform various preprocessing methods (<a href="https://quanteda.io/articles/quickstart.html#tokenizing-texts">quanteda Quick Start: Tokenizing texts</a>).</p>
<p>Lastly, you can make a <code>dfm</code> object with a function <code><a href="https://quanteda.io/reference/dfm.html">dfm()</a></code> in <strong>quanteda</strong>.</p>
<p>Here is an example preprocessing steps with <strong>quanteda</strong>. In this example, we read texts with <strong>readtext</strong> package.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">quanteda</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">readtext</span>)

<span class="co"># Read text files</span>
<span class="no">raw_docs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span>(<span class="st">"PATH_TO_THE_FOLDER/*.txt"</span>,
                     <span class="kw">encoding</span> <span class="kw">=</span> <span class="st">"UTF-8"</span>)

<span class="co"># Preprocessing with quanteda and create a dfm object</span>
<span class="no">key_corpus</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html">corpus</a></span>(<span class="no">raw_docs</span>, <span class="kw">text_field</span> <span class="kw">=</span> <span class="st">"text"</span>)

<span class="co"># If you use the covariate model, please consider using `docvars` argument</span>
<span class="no">key_corpus</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html">corpus</a></span>(<span class="no">raw_docs</span>, <span class="kw">text_field</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">docvars</span> <span class="kw">=</span> <span class="no">COVARIATES</span>)

<span class="no">key_tokens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens.html">tokens</a></span>(<span class="no">key_corpus</span>,
                     <span class="kw">remove_numbers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                     <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                     <span class="kw">remove_symbols</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                     <span class="kw">remove_separators</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                     <span class="kw">remove_url</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
                <span class="fu"><a href="https://quanteda.io/reference/tokens_tolower.html">tokens_tolower</a></span>() <span class="kw">%&gt;%</span>
                <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html">tokens_remove</a></span>(<span class="fu"><a href="https://quanteda.io/reference/reexports.html">stopwords</a></span>(<span class="st">"english"</span>)) <span class="kw">%&gt;%</span>
                <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html">tokens_select</a></span>(<span class="kw">min_nchar</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="no">key_dfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm.html">dfm</a></span>(<span class="no">key_tokens</span>) <span class="kw">%&gt;%</span>
             <span class="fu"><a href="https://quanteda.io/reference/dfm_trim.html">dfm_trim</a></span>(<span class="kw">min_termfreq</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">min_docfreq</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># Read texts into keyATM</span>
<span class="no">keyATM_docs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span>(<span class="no">key_dfm</span>)</pre></body></html></div>
<p>You can also use <code><a href="https://rdrr.io/r/base/c.html">c(stopwords("english"), "your", "stopwords")</a></code> if you want to add corpus specific stopwords.</p>
</div>
<div id="alternative-ways-to-read-texts" class="section level3">
<h3 class="hasAnchor">
<a href="#alternative-ways-to-read-texts" class="anchor"></a>Alternative ways to read texts</h3>
<p>There are two other ways to read texts, which we do not recommend. Please make sure to preprocess texts with other packages or softwares. In both methods, each word should be separated by a single space.</p>
<p>Using data.frame or tibble: <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code> can read <code>data.frame</code> and <code>tibble</code> if you preprocess texts without <strong>quanteda</strong>. Please store texts in a column named <code>text</code>.</p>
<pre><code>&gt; head(docs)  # `docs` stores preprocessed texts
# A tibble: 6 x 1
  text                                                                      
  &lt;chr&gt;                                                                     
1 h.r h.r one hundred first congress congress congress united u...
2 first congress one congress congress united united state stae...
3 one one one one one one one one one one one one one one one o...
4 h.r h.r one one one hundred hundred first first congress cong...
5 congress congress one united united united united united unit...
6 h.r h.r one one one one one hundred hundred first congress co...</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Read texts into keyATM</span>
<span class="no">keyATM_docs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span>(<span class="no">docs</span>)</pre></body></html></div>
<p>Reading directly from files: If you have preprocessed text files, you can pass a list of files to <code><a href="../../reference/keyATM_read.html">keyATM_read()</a></code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Create a list of paths to text files</span>
<span class="no">textfiles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">PATH_TO_THE_FOLDER</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"*.txt"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Read texts into keyATM</span>
<span class="no">keyATM_docs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span>(<span class="no">textfiles</span>)</pre></body></html></div>
</div>
</div>
<div id="reading-documents-into-keyatm" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-documents-into-keyatm" class="anchor"></a>Reading documents into keyATM</h2>
<p>Before fitting the model, we need to read texts and keywords into <strong>keyATM</strong>. Here we use <strong>quanteda</strong>’s <code>dfm</code>.</p>
<p><strong>keyATM</strong> package includes a tidy dataset for illustration purpose. In this example, we use text data of the Congressional Bills scraped from <a href="https://www.congress.gov/">congress.gov</a> (in total 140 documents). You can load this data by <code><a href="https://rdrr.io/r/utils/data.html">data(keyATM_data_bills)</a></code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">quanteda</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">keyATM</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">keyATM_data_bills</span>)
<span class="no">bills_dfm</span> <span class="kw">&lt;-</span> <span class="no">keyATM_data_bills</span>$<span class="no">doc_dfm</span>  <span class="co"># quanteda dfm object</span>
<span class="no">keyATM_docs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/keyATM_read.html">keyATM_read</a></span>(<span class="no">bills_dfm</span>)</pre></body></html></div>
</div>
<div id="preparing-keywords" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-keywords" class="anchor"></a>Preparing keywords</h2>
<div id="keywords-list" class="section level3">
<h3 class="hasAnchor">
<a href="#keywords-list" class="anchor"></a>Keywords list</h3>
<p>Keywords should be in a list. For example, we prepare four keyword-topics. Keywrods should be stored in a list. Each element in the list is a character vector, which corresponds to a single keyword-topic. The number of keywords can vary between topics.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">bills_keywords</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                       <span class="kw">Education</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"education"</span>, <span class="st">"child"</span>, <span class="st">"student"</span>),
                       <span class="kw">Law</span>       <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"court"</span>, <span class="st">"law"</span>, <span class="st">"attorney"</span>),
                       <span class="kw">Health</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"public"</span>, <span class="st">"health"</span>),
                       <span class="kw">Drug</span>      <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"drug"</span>)
                      )</pre></body></html></div>
</div>
<div id="checking-keywords" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-keywords" class="anchor"></a>Checking keywords</h3>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../../reference/visualize_keywords.html">visualize_keywords</a></span>(<span class="no">keyATM_docs</span>, <span class="no">bills_keywords</span>)</pre></body></html></div>
<p><img src="Preparation_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;"> The figure helps you to check the frequency of keywords. Including low-frequency keywords do not help the model in general. <strong>keyATM</strong> automatically prune keywords that do not appear in the documents.</p>
<p>Proportion is defined as a number of times a keyword occurs in the corpus divided by the total length of documents. This measures the frequency of the keyword in the corpus. Formally, the proportion of the keyword <span class="math inline">\(v\)</span> is, <span class="math display">\[
\begin{align*}
    \text{Proportion of }v = \frac{\sum_{d=1}^{D} \sum_{i=1}^{N_d} I(w_{di} = v) }{\sum_{d=1}^{D} N_d}
\end{align*}
\]</span> where <span class="math inline">\(N_d\)</span> is the length of the document <span class="math inline">\(d\)</span> and <span class="math inline">\(I\)</span> is an indicator function. Keywords of each toopic are ordered by the proportion (x-axsis).</p>
</div>
</div>
<div id="next-step" class="section level2">
<h2 class="hasAnchor">
<a href="#next-step" class="anchor"></a>Next Step</h2>
<p>Now you have texts and keywords! The next step is to fit a model <code><a href="../../reference/keyATM.html">keyATM()</a></code>. <strong>keyATM</strong> has three models:</p>
<ul>
<li>
<a href="keyATM_base.html">keyATM Base</a>
<ul>
<li>This is an extension of the most famous topic model, Latent Dirichlet Allocation.</li>
<li>If you do not have covariates, this model is your first option.</li>
</ul>
</li>
<li>
<a href="keyATM_cov.html">keyATM Covariates</a>
<ul>
<li>If you have covariates, please use this model.</li>
<li>This model uses covariates to model topic prevalence (the prior of document-topic distribution).</li>
</ul>
</li>
<li>
<a href="keyATM_dynamic.html">keyATM Dynamic</a>
<ul>
<li>If you want to explicitly consider time structure, please use this model.</li>
</ul>
</li>
</ul>
<p>You can find details in <a href="FAQ.html#which-model-to-use">FAQ</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://shusei-e.github.io">Shusei Eshima</a>, <a href="https://polisci.mit.edu/people/tomoya-sasaki">Tomoya Sasaki</a>, <a href="https://imai.fas.harvard.edu/">Kosuke Imai</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
